# 📖 MCP Sidecar 使用指南

**MCP Sidecar** 是一个连接你的浏览器 AI（ChatGPT, Gemini）与本地 VS Code 开发环境的**智能传输通道**。

在这个工作流中，Sidecar 负责处理繁琐的**上下文搬运**和**代码写入**，让你和 VS Code 专注于核心逻辑开发。

---

## 🚀 核心工作流 (The Core Loop)

与 AI 协作只需遵循简单的三步循环：**初始化 -> 规划与读取 -> 执行与写入**。

### 第一步：一键初始化 (Init Context)

在开始新任务时，你需要让 AI 了解你的项目结构、可用工具以及“它该如何与你说话”。

1. 找到 Sidecar 界面上的 **紫色火箭图标 (Init Context)** 🚀。
2. **点击它**。

- _后台动作_：Sidecar 会自动打包 **系统协议** + **工具列表** + **项目目录树**。
- _结果_：全部内容已自动复制到你的剪贴板。

3. **粘贴给 AI**。

- AI 会回复：“明白，我已了解项目结构，请给出指令。”

### 第二步：智能读取 (Smart Read)

当 AI 需要查看代码细节来分析问题时：

1. **AI 输出指令**：AI 会在回复中包含类似这样的内容：

   > "为了分析 Bug，我需要查看这两个文件：
   > `mcp:internal:read_file({"path": "src/App.tsx"})`
   > `mcp:internal:read_file({"path": "src/utils.ts"})`"

2. **整段复制**：不要手动挑出指令，**直接复制 AI 的整段回复**。
3. **粘贴到 Sidecar**：将文本粘贴到顶部的 Command Input 区域。
4. **智能解析**：

- 界面会自动识别出多个读取指令，变成一个 **“待执行列表”**。

5. **点击 "Run All"** ▶️。

- _结果_：所有文件的内容会被合并读取，并自动复制到剪贴板。

6. **粘贴回 AI**。

### 第三步：确认写入 (Smart Write)

当 AI 找到解决方案并准备修改代码时：

1. **AI 输出指令**：

   > "请应用以下修复：
   > `mcp:fs:write_file({"path": "src/App.tsx", "content": "..."})`"

2. **复制并粘贴**到 Sidecar。
3. **点击执行**。

- _结果_：文件在本地被修改。
- _后续_：**切换回 VS Code**，你能在编辑器里立刻看到文件的变化（VS Code 此时会高亮显示变更）。

---

## 🛠️ 功能详解

### 1. 智能指令解析器 (Smart Executor)

Command Input 不仅仅是一个输入框，它是你的智能代理。

- **自然语言混排**：它能从一大段 AI 的废话中精准提取出 `mcp:xxx` 指令。
- **批量执行**：一次性处理多个文件的读取请求，极速构建上下文。

### 2. 项目资源管理器 (Project Explorer)

位于界面中部的树状区域，辅助你手动补充信息。

- **点击文件**：自动读取内容并复制。当你觉得 AI 遗漏了某个文件时，可以在这里手动点一下，然后补充发给 AI。

### 3. 快捷动作 (Quick Actions)

- 🚀 **Init Context**: 最常用的按钮，一键让 AI 进入状态。
- 🌿 **Git Diff**: 这是一个轻量级的检查工具。
- _场景_：虽然你主要用 VS Code 看 Diff，但如果在 Sidecar 执行写入后想快速确认“AI 到底改了啥”而不想切屏，可以用这个快速扫一眼。

---

## ⚙️ 关键概念：双轨制策略

为了安全与效率，Sidecar 将“读”和“写”分开处理：

1. **`internal` (读取专用)**:

- **用途**：Sidecar 用来浏览目录、读取文件内容发给 AI。
- **指令**：`mcp:internal:read_file`

2. **`fs` (写入专用)**:

- **用途**：**AI 用来修改代码**。
- **指令**：`mcp:fs:write_file`
- **注意**：这需要你在 `mcp.config.json` 中配置标准的 Filesystem Server。

---

## 💡 最佳实践 Tips (配合 VS Code)

- **作为 VS Code 的僚机**：
- 在 VS Code 里写代码、运行项目、调试。
- 在 浏览器+Sidecar 里与 AI 讨论思路、生成代码块、修复报错。

- **不要手写 JSON**：
- 参数极其复杂（尤其是 `content`），永远让 AI 去生成指令。如果 AI 格式不对，点击 **Init Context** 再发一遍协议即可。

- **利用 "Run All"**：
- 当 AI 想看 5 个文件时，一次性把它的回复粘贴进来，一键读取 5 个文件，效率倍增。

- **信任但验证**：
- Sidecar 执行完 `write_file` 后，文件会立即在 VS Code 更新。利用 VS Code 强大的 GitLens 或原生 Diff 功能来审查 AI 的修改。
